<script>
    AOS.init();

    // --- NEW: FETCH FROM JSON DATABASE ---
    async function checkStatus() {
        const input = document.getElementById('trackInput').value.toUpperCase().trim();
        const resultBox = document.getElementById('trackResult');

        resultBox.innerHTML = '<div class="text-orange-500 animate-pulse">Searching Satellite Network...</div>';
        resultBox.classList.remove('hidden');

        try {
            // Fetch the JSON file (with timestamp to prevent caching)
            const response = await fetch('/tracking.json?t=' + new Date().getTime());
            const data = await response.json();

            // Find the shipment
            const shipment = data.shipments.find(s => s.id === input);

            if (shipment) {
                resultBox.innerHTML = `
                    <div class="text-xs text-gray-500 uppercase tracking-widest mb-1">Current Status</div>
                    <div class="text-lg font-bold ${shipment.color}">${shipment.status}</div>
                    <div class="mt-2 text-xs text-gray-400">Last Updated: Just now</div>
                `;
            } else {
                resultBox.innerHTML = `<div class="text-red-400 font-bold">ID Not Found</div>`;
            }
        } catch (error) {
            console.error("Database Error:", error);
            resultBox.innerHTML = `<div class="text-red-400 font-bold">System Offline</div>`;
        }
    }

    // --- MODAL LOGIC ---
    function openTrackingModal() {
        document.getElementById('trackingModal').classList.remove('hidden');
        document.getElementById('trackingModal').classList.add('flex');
    }
    function closeTrackingModal() {
        document.getElementById('trackingModal').classList.add('hidden');
        document.getElementById('trackingModal').classList.remove('flex');
        document.getElementById('trackResult').classList.add('hidden');
        document.getElementById('trackInput').value = '';
    }

    // --- NETLIFY IDENTITY REDIRECT ---
    if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
            if (!user) {
                window.netlifyIdentity.on("login", () => {
                    document.location.href = "/admin.html";
                });
            }
        });
    }
</script>
