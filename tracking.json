<script>
        AOS.init();

        // --- UPDATED: SMART SEARCH FOR REAL ADMIN FILES ---
        async function checkStatus() {
            // 1. Get the ID the user typed (Match HTML ID 'trackInput')
            const trackingId = document.getElementById('trackInput').value.trim();
            const resultDiv = document.getElementById('trackResult');
            
            // 2. Show searching animation
            resultDiv.innerHTML = '<div class="text-orange-500 animate-pulse">Searching Global Satellite Network...</div>';
            resultDiv.classList.remove('hidden');

            if (!trackingId) {
                resultDiv.innerHTML = '<div class="text-red-400 font-bold">Please enter a Tracking ID</div>';
                return;
            }

            try {
                // 3. TRY TO FIND THE SPECIFIC JSON FILE
                // We add "?v=" + time to force the browser to get the freshest version
                const response = await fetch(`/content/shipments/${trackingId}.json?v=${new Date().getTime()}`);
                
                // 4. If file not found (404)
                if (!response.ok) {
                    throw new Error("Shipment not found");
                }

                // 5. If found, show the data!
                const data = await response.json();
                
                // SAFEGUARDS: We use "?." just in case a field is empty
                resultDiv.innerHTML = `
                    <div class="bg-white/5 border border-white/10 rounded-lg p-6 text-left space-y-4">
                        
                        <div class="border-b border-white/10 pb-3 flex justify-between items-end">
                            <div>
                                <div class="text-xs text-gray-500 uppercase tracking-widest mb-1">Current Status</div>
                                <div class="text-xl font-bold ${getStatusColor(data.status)}">${data.status}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">Location</div>
                                <div class="text-sm text-white font-mono">${data.location || 'In Transit'}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="bg-black/20 p-3 rounded">
                                <div class="text-[10px] text-gray-500 uppercase mb-1">From</div>
                                <div class="text-white font-bold">${data.sender?.name || 'N/A'}</div>
                                <div class="text-xs text-gray-400">${data.sender?.address || ''}</div>
                            </div>
                            <div class="bg-black/20 p-3 rounded">
                                <div class="text-[10px] text-gray-500 uppercase mb-1">To</div>
                                <div class="text-white font-bold">${data.receiver?.name || 'N/A'}</div>
                                <div class="text-xs text-gray-400">${data.receiver?.address || ''}</div>
                            </div>
                        </div>

                        <div class="flex gap-4 items-start">
                             ${data.package?.image ? `<img src="${data.package.image}" class="w-16 h-16 object-cover rounded border border-white/10">` : ''}
                             <div>
                                <div class="text-[10px] text-gray-500 uppercase">Cargo Details</div>
                                <div class="text-white">${data.package?.description || 'Consignment'}</div>
                                <div class="text-orange-400 text-xs mt-1 font-mono">${data.package?.weight || '0'} KG</div>
                             </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                // If ID is wrong or file doesn't exist yet
                resultDiv.innerHTML = `
                    <div class="bg-red-500/10 border border-red-500/50 text-red-400 px-4 py-3 rounded">
                        <i class="fa-solid fa-triangle-exclamation mr-2"></i> 
                        Tracking ID <strong>"${trackingId}"</strong> not found in database.
                    </div>
                `;
            }
        }

        // Helper to pick colors for status text
        function getStatusColor(status) {
            if (status === 'Delivered') return 'text-green-400';
            if (status === 'Pending') return 'text-yellow-400';
            if (status === 'On Hold') return 'text-red-400';
            return 'text-blue-400'; // Default
        }

        // --- MODAL LOGIC ---
        function openTrackingModal() {
            document.getElementById('trackingModal').classList.remove('hidden');
            document.getElementById('trackingModal').classList.add('flex');
        }
        function closeTrackingModal() {
            document.getElementById('trackingModal').classList.add('hidden');
            document.getElementById('trackingModal').classList.remove('flex');
            document.getElementById('trackResult').classList.add('hidden');
            document.getElementById('trackInput').value = '';
        }

        // --- NETLIFY IDENTITY REDIRECT ---
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin.html";
                    });
                }
            });
        }
    </script>
